@inherits DevBaseEditor



<DxGridLayoutItem Column="ColumnIndex"
                  ColumnSpan="ColumnSpan"
                  Row="RowIndex"
                  RowSpan="RowSpan"
                  Visible="Visible">

    <Template>
        <DxTextBox @ref="_dxTextBox"
                   @bind-Text="@Value"
                   @onkeydown="@KeyDownAsync"
                   @ondblclick="@ClickAsync"
                   Enabled="Enabled"
                   NullText="@NullText"
                   ReadOnly="true"
                   ClearButtonDisplayMode="ClearButtonDisplayMode">
            <Buttons>
                <DxEditorButton IconCssClass="button-edit-css"
                                @onclick="@ClickAsync"
                                @attributes="@Attributes" />
            </Buttons>
        </DxTextBox>
    </Template>
</DxGridLayoutItem>


<DevLabel Caption="@Caption"
          ColumnIndex="ColumnIndex-2"
          RowIndex="RowIndex"
          Visible="Visible">

</DevLabel>

<DevLabel Caption="@SeperateCaption"
          ColumnIndex="ColumnIndex-1"
          RowIndex="RowIndex"
          Visible="Visible">

</DevLabel>


@code {
    private DxTextBox _dxTextBox;
    private string _value;
    private Dictionary<string, object> Attributes;

    [Parameter] public ICoreCommonService Service { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public EventCallback ButtonClickInvokeFunction { get; set; }
    [Parameter] public EventCallback DeleteButtonKeyDownInvokeFunction { get; set; }

    [Parameter]
    public string Value
    {
        get => _value;
        set
        {
            if (_value == value) return;
            _value = value;
            ValueChanged.InvokeAsync(value);
        }
    }

    private async Task ClickAsync()
    {
        if (Enabled)
        {
            Service.ActiveEditComponent = _dxTextBox;
            await ButtonClickInvokeFunction.InvokeAsync();
        }
    }



    private async Task KeyDownAsync(KeyboardEventArgs arg)
    {
        switch (arg.Key)
        {
            case "F2":
                await ClickAsync();
                break;

            case "Delete":
                await DeleteAsync();
                break;
        }
    }

    private async Task DeleteAsync()
    {
        if (!DeleteButtonKeyDownInvokeFunction.HasDelegate) return;
        Value = null;
        await DeleteButtonKeyDownInvokeFunction.InvokeAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (IsFocus && Visible && firstRender)
            await _dxTextBox.FocusAsync();
    }

    protected override void OnParametersSet()
    {
        if (!Enabled)
        {
            Attributes = new Dictionary<string, object>();
            Attributes.Add("disabled", "disabled");
        }
        else
            Attributes?.Remove("disabled");
    }

}